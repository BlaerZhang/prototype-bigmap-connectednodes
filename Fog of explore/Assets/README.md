# 战争迷雾探索游戏

本项目实现了一个2D探索游戏，玩家可以在节点和路径组成的地图上移动，同时具有视野范围和战争迷雾系统。

## 核心功能

1. **节点和路径系统**：创建一个由多个节点和连接它们的路径组成的地图
2. **路径限制移动**：玩家只能沿着路径移动，不能直接穿越地图
3. **曲线和折线路径**：支持直线、贝塞尔曲线和分段折线路径
4. **战争迷雾**：未探索区域的节点和路径保持隐藏，探索过的区域保持可见
5. **独立迷雾层**：新的迷雾系统使用与地图相同的精灵，覆盖在节点和路径之上

## 设置指南

### 场景设置

1. **创建场景**：
   - 添加一个大型背景图像作为地图底图
   - 确保背景图像有一个 SpriteRenderer 组件
   - 设置背景图像的 SortingOrder 为 -10

2. **设置游戏管理器**：
   - 创建一个空物体，命名为 `GameManager`
   - 添加 `GameManager.cs` 脚本
   - 设置世界大小 (`worldSize`) 和玩家预制体引用

3. **创建玩家**：
   - 创建一个 GameObject 作为玩家
   - 添加 SpriteRenderer 组件，设置玩家图像
   - 添加 PlayerMovement.cs 脚本
   - 设置玩家的 SortingOrder 为 2（确保在迷雾层之上）
   - 调整移动速度和视野半径

4. **创建节点**：
   - 对每个地图节点（如城镇）创建一个 GameObject
   - 添加 SpriteRenderer 组件，设置节点图标
   - 添加 MapNode.cs 脚本
   - 设置节点名称和初始可见性

5. **创建路径**：
   - 对每条路径创建一个 GameObject
   - 添加 LineRenderer 组件
   - 添加 MapPath.cs 脚本
   - 设置连接的两个节点 (nodeA 和 nodeB)
   - 选择路径类型（直线、贝塞尔曲线或折线）
   - 如果使用曲线或折线，添加控制点作为路径的子物体

6. **设置迷雾系统**：
   - 在场景中创建一个空物体
   - 添加 `FogOfWarSetup` 脚本
   - 设置引用：
     * 玩家 Transform
     * 地图渲染器（底图的 SpriteRenderer）
   - 调整视野半径和边缘渐变大小
   - 设置迷雾颜色和透明度
   - 点击 Play 或者在代码中调用 `SetupFogOfWar()` 方法自动创建迷雾系统

## 迷雾系统详解

新的迷雾系统使用两个相同的精灵渲染器来创建迷雾效果：

1. **底图层**：原始地图精灵 (SortingOrder = -10)
2. **迷雾层**：与底图完全相同的精灵，但纹理会被动态修改 (SortingOrder = 1)

### 工作原理

1. 迷雾系统在启动时会创建一个与底图相同的精灵作为迷雾层
2. 迷雾层最初完全不透明（使用指定的迷雾颜色）
3. 当玩家移动时，系统会在迷雾纹理上绘制透明区域，形成玩家视野
4. 玩家移动的轨迹会永久保持可见，形成探索区域
5. 节点和路径独立控制其可见性，当在玩家视野中时显示

### 自定义参数

迷雾系统可以通过以下参数进行自定义：

- **视野半径**：玩家可以看到的区域大小
- **边缘渐变大小**：视野边缘的渐变效果宽度
- **迷雾颜色**：迷雾的颜色和不透明度（建议使用半透明黑色）
- **纹理分辨率**：影响迷雾质量和性能，默认为1024x1024

## 使用说明

### 移动控制

- 使用方向键（上、下、左、右）控制角色移动
- 玩家只能沿着路径移动
- 在节点处，移动方向决定选择哪条路径
- 在路径上，可以改变方向或停止

### 探索地图

- 探索的区域会永久保持可见
- 玩家视野会动态显示周围区域
- 视野范围内的节点和路径会变为可见

## 迷雾系统集成到其他项目

要将迷雾系统集成到其他项目中，只需复制以下文件：

1. `FogOfWar.cs` - 核心迷雾系统实现
2. `FogOfWarSetup.cs` - 迷雾系统快速设置工具（可选）

然后在你的场景中：

1. 创建一个空物体并添加 `FogOfWarSetup` 组件
2. 设置玩家Transform和地图渲染器引用
3. 调整迷雾参数
4. 运行游戏或调用 `SetupFogOfWar()` 方法

## 注意事项

- 确保所有路径都有正确的节点引用
- 路径的线渲染器应具有足够的宽度和合适的材质
- 迷雾层和底图必须使用完全相同的精灵和变换设置
- 调整排序顺序确保正确的渲染顺序：底图 < 节点/路径 < 迷雾层 < 玩家 